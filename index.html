<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DISC — самооценка (медицинские представители)</title>
  <style>
    :root{
      /* Если у тебя есть точные Sandoz HEX из брендгайда — подставь здесь */
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#0b1220;
      --muted:#5b667a;
      --line:#e3e8f2;
      --primary:#0057B8;
      --primary2:#00A3E0;
      --shadow: 0 10px 25px rgba(11,18,32,.08);
      --radius: 16px;
      --radius2: 22px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% -10%, rgba(0,87,184,.12), transparent 55%),
        radial-gradient(1200px 600px at 95% 0%, rgba(0,163,224,.10), transparent 55%),
        var(--bg);
    }

    .wrap{max-width:1120px; margin:0 auto; padding:24px 16px 64px;}
    .topbar{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:18px; flex-wrap:wrap;}
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{width:44px; height:44px; border-radius:14px; background: linear-gradient(135deg, var(--primary), var(--primary2)); box-shadow: var(--shadow);}
    h1{margin:0; font-size:20px; letter-spacing:.2px;}
    .subtitle{margin:2px 0 0; color:var(--muted); font-size:13px; line-height:1.3;}

    .actions{display:flex; gap:10px; flex-wrap:wrap;}
    button{border:0; border-radius:12px; padding:10px 12px; font-weight:800; cursor:pointer; background: var(--primary); color:white; box-shadow: 0 8px 18px rgba(0,87,184,.20);}
    button.secondary{background:#fff; color:var(--text); border:1px solid var(--line); box-shadow:none;}
    button:disabled{opacity:.55; cursor:not-allowed;}

    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:16px; align-items:start;}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{background: var(--card); border: 1px solid var(--line); border-radius: var(--radius2); box-shadow: var(--shadow); padding:16px;}
    .card h2{margin:0 0 10px; font-size:16px;}
    .hint{color:var(--muted); font-size:13px; line-height:1.45;}

    .pillrow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;}
    .pill{font-size:12px; padding:6px 10px; border-radius:999px; background:#f1f5ff; border:1px solid #dbe6ff; color:#1b2d6b; font-weight:800;}

    .testHeader{display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:10px;}
    .progress{display:flex; align-items:center; gap:10px; color:var(--muted); font-size:13px;}
    .bar{width:190px; height:10px; background:#edf1f7; border-radius:999px; overflow:hidden; border:1px solid var(--line);}
    .bar > div{height:100%; width:0%; background: linear-gradient(90deg, var(--primary), var(--primary2));}

    .block{border:1px solid var(--line); border-radius: var(--radius); padding:12px; margin:10px 0; background:#fff;}
    .blockTop{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-start; margin-bottom:8px;}
    .bTitle{font-weight:900; font-size:13px;}

    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden;}
    th, td{padding:10px; vertical-align:top; border-bottom:1px solid var(--line);}
    th{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.6px;}
    tr:last-child td{border-bottom:none;}
    .opt{font-size:13px; line-height:1.35;}

    .controls{display:grid; grid-template-columns: 1fr 1fr; gap:8px; min-width:250px;}
    select{width:100%; padding:10px 10px; border-radius:12px; border:1px solid var(--line); background:#fff; font-weight:800; outline:none;}

    .err{margin-top:8px; padding:10px 12px; border-radius:12px; border:1px solid rgba(240,68,56,.35); background: rgba(240,68,56,.06); color:#8a1f1a; font-size:13px; display:none;}

    .scoreCard{border:1px solid var(--line); border-radius: var(--radius); padding:12px; background: linear-gradient(180deg, rgba(0,87,184,.05), transparent 55%);}
    .resultTitle{display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-top:6px;}
    .badge{padding:6px 10px; border-radius:999px; font-weight:900; font-family:var(--mono); background:#f1f5ff; border:1px solid #dbe6ff; color:#1b2d6b; white-space:nowrap;}

    .scoreRow{display:grid; grid-template-columns: 50px 1fr 60px; align-items:center; gap:10px; margin:10px 0;}
    .scoreRow .k{font-family:var(--mono); font-weight:900;}
    .meter{height:10px; background:#edf1f7; border-radius:999px; overflow:hidden; border:1px solid var(--line);}
    .meter > div{height:100%; width:0%; background: linear-gradient(90deg, var(--primary), var(--primary2));}
    .v{font-family:var(--mono); font-weight:900; text-align:right;}

    details{border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:#fff; margin:10px 0;}
    summary{cursor:pointer; font-weight:900; font-size:13px;}
    .list{margin:8px 0 0; padding-left:18px;}
    .list li{margin:6px 0;}

    .foot{margin-top:14px; font-size:12px; color:var(--muted); border-top:1px solid var(--line); padding-top:12px;}

    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:16px; background:#0b1220; color:#fff; padding:10px 12px; border-radius:999px; box-shadow:var(--shadow); font-size:13px; display:none; max-width:min(92vw, 560px);}

    .small{color:var(--muted); font-size:12px; line-height:1.45; margin-top:8px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>DISC — самооценка (медицинские представители)</h1>
          <div class="subtitle">24 блока • выбор MOST/LEAST как «Вариант 1–4» • результаты считаются локально (ничего никуда не отправляется)</div>
        </div>
      </div>
      <div class="actions">
        <button class="secondary" id="btnReset" type="button">Сбросить</button>
        <button id="btnCalc" type="button">Показать результат</button>
        <button class="secondary" id="btnDownload" type="button" disabled>Скачать результат (PDF)</button>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="testCard">
        <div class="testHeader">
          <div>
            <h2>Инструкция</h2>
            <div class="hint" id="instructions"></div>
            <div class="pillrow">
              <div class="pill">MOST/LEAST = выбор варианта, не оценка</div>
              <div class="pill">Время: 6–10 минут</div>
              <div class="pill">Самопрофиль, не диагностика</div>
            </div>
          </div>
          <div class="progress" aria-live="polite">
            <div class="bar" aria-hidden="true"><div id="progFill"></div></div>
            <div><span id="answered">0</span>/24 заполнено</div>
          </div>
        </div>

        <div id="blocks"></div>
        <div class="foot">Подсказка: если сомневаешься — выбирай вариант, который чаще проявляется <b>на работе</b> или <b>под давлением</b>.</div>
      </div>

      <div class="card" id="resultCard">
        <h2>Результат</h2>
        <div class="hint">Заполни все 24 блока и нажми «Показать результат».</div>

        <div class="scoreCard" style="margin-top:10px;">
          <div class="resultTitle">
            <div>
              <div class="hint" style="margin-bottom:2px;">NET = MOST − LEAST</div>
              <div style="font-size:18px; font-weight:900;" id="leadText">—</div>
            </div>
            <div class="badge" id="leadBadge">DISC</div>
          </div>

          <div id="scoreRows"></div>
          <div class="small" id="mixNote"></div>
        </div>

        <details open>
          <summary>Как читать результат</summary>
          <ul class="list">
            <li><b>Лидирующий стиль</b> — максимальный NET.</li>
            <li><b>Вторичный стиль</b> — второй по величине NET.</li>
            <li>Если разница между 1 и 2 стилем ≤ 2 — вероятен <b>смешанный профиль</b> (это нормально для медпреда).</li>
          </ul>
        </details>

        <details open>
          <summary>Рекомендации для визита (по ведущему стилю)</summary>
          <div class="hint" id="visitTips" style="margin-top:8px;"></div>
        </details>

        <details>
          <summary>Важно</summary>
          <ul class="list">
            <li>Страница работает локально: результаты никуда не отправляются.</li>
            <li>Это базовый самопрофиль для развития коммуникации и адаптации стиля.</li>
          </ul>
        </details>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
  // Данные из Excel v2 (вшиты 1:1)
  const INSTRUCTIONS = ["Формат: 24 блока утверждений. В каждом блоке выберите:","• MOST — утверждение, которое НАИБОЛЕЕ похоже на ваше типичное поведение на работе.","• LEAST — утверждение, которое НАИМЕНЕЕ похоже.","Рекомендации: отвечайте про «обычный рабочий день», не про идеальную версию себя.","Ограничение: это короткая самооценка, НЕ клиническая диагностика и не предназначена для решений о найме.","Счёт по 4 шкалам (D/I/S/C), основной и вторичный стиль, и подсказки для визита к врачу."];

  const BLOCKS = [{"n":1,"options":["Сначала выясняю потребности и внимательно слушаю.","Легко завожу разговор и создаю тёплую атмосферу.","Опираюсь на данные и заранее продумываю детали.","Быстро обозначаю цель визита и веду разговор к решению."],"mapping":["S","I","C","D"]},{"n":2,"options":["Проверяю формулировки и соответствие материалам/регламентам.","Стараюсь поддерживать стабильность и не создавать лишних рисков.","Предпочитаю решать быстро и не затягивать согласования.","Могу «зажечь» и вовлечь и удерживать внимание на презентации."],"mapping":["C","S","D","I"]},{"n":3,"options":["Мне важно, чтобы люди меня поддерживали и я их вдохновлял(а).","Мне важно, чтобы всё было логично и без ошибок.","Мне важно, чтобы было спокойно, предсказуемо и по плану.","Мне важно, чтобы был результат и движение вперёд."],"mapping":["I","C","S","D"]},{"n":4,"options":["В споре я скорее разряжаю обстановку юмором/эмпатией.","В споре я скорее ищу компромисс и сохраняю отношения.","В споре я скорее настаиваю и добиваюсь решения.","В споре я скорее уточняю факты и критерии."],"mapping":["I","S","D","C"]},{"n":5,"options":["Планирую день так, чтобы было место для общения и новых контактов.","Планирую день так, чтобы всё было чётко и по стандартам.","Планирую день так, чтобы всё было спокойно и без перегруза.","Планирую день так, чтобы закрыть максимум задач."],"mapping":["I","C","S","D"]},{"n":6,"options":["Часто нахожу нестандартный подход через личный контакт.","Чаще соблюдаю проверенный сценарий и избегаю экспериментов.","Если нужно — уверенно, спокойно «продавлю» сложное согласование.","Я скорее доработаю материал, чем выйду с сырым вариантом."],"mapping":["I","S","D","C"]},{"n":7,"options":["Нравится, когда отношения долгие и надёжные.","Нравится, когда можно влиять и убеждать.","Нравится, когда есть вызов и победа.","Нравится, когда качество выше скорости."],"mapping":["S","I","D","C"]},{"n":8,"options":["На визите легко импровизирую и подстраиваюсь по настроению.","На визите держу структуру и логический порядок аргументов.","На визите держу темп и веду к следующему шагу.","На визите выдерживаю паузы и даю собеседнику пространство."],"mapping":["I","C","D","S"]},{"n":9,"options":["Если план рушится, я оперативно перестраиваюсь и иду дальше.","Если план рушится, я стараюсь сохранить спокойный темп и отношения.","Если план рушится, я анализирую причины и корректирую систему.","Если план рушится, я включаю энергию и удерживаю позитив."],"mapping":["D","S","C","I"]},{"n":10,"options":["Сложные переговоры для меня — про спокойствие и уважение.","Сложные переговоры для меня — про факты и аргументы.","Сложные переговоры для меня — про победу и результат.","Сложные переговоры для меня — про доверие и контакт."],"mapping":["S","C","D","I"]},{"n":11,"options":["Я чаще уступаю, чтобы сохранить отношения.","Мне проще договориться через эмоции и вовлечение.","Я чаще держусь правил/регламентов и осторожен(на).","Я легко говорю «нет» и ставлю границы."],"mapping":["S","I","C","D"]},{"n":12,"options":["Когда есть дедлайн, уточняю требования и убираю неопределённость.","Когда есть дедлайн, стараюсь сохранить стабильный темп без паники.","Когда есть дедлайн, ускоряю темп и требую фокуса.","Когда есть дедлайн, поднимаю мотивацию и «подзаряжаю» команду."],"mapping":["C","S","D","I"]},{"n":13,"options":["Я скорее проверяю и уточняю, чем начинаю без деталей.","Я скорее начинаю и корректирую по ходу.","Я скорее выжидаю и наблюдаю, чем тороплюсь.","Я скорее вовлекаю людей, чем углубляюсь в детали."],"mapping":["C","D","S","I"]},{"n":14,"options":["Мне легче держать темп и много визитов подряд.","Мне легче глубоко подготовиться и быть точным.","Мне легче строить устойчивые отношения и сопровождать.","Мне легче быть на сцене/в коммуникации и заводить контакты."],"mapping":["D","C","S","I"]},{"n":15,"options":["Я предпочитаю ясность критериев и согласованность данных.","Я предпочитаю стабильность и предсказуемость.","Я предпочитаю динамику, конкуренцию и скорость.","Я предпочитаю общение, свободу и творчество."],"mapping":["C","S","D","I"]},{"n":16,"options":["В конце визита я фиксирую конкретный следующий шаг и срок.","В конце визита я оставляю приятное впечатление и контакт.","В конце визита я уточняю, всё ли корректно и что важно врачу.","В конце визита я подтверждаю договорённость и даю поддержку."],"mapping":["D","I","C","S"]},{"n":17,"options":["Если врач сомневается, я добавлю эмоцию/историю/пример.","Если врач сомневается, я уточню возражение и предложу решение.","Если врач сомневается, я дам время и аккуратно сопровожу.","Если врач сомневается, я предложу данные/исследования/аргументы."],"mapping":["I","D","S","C"]},{"n":18,"options":["В команде я чаще драйвер и тяну вперёд.","В команде я чаще объединяю и создаю атмосферу.","В команде я чаще удерживаю стабильность и поддерживаю.","В команде я чаще контролирую качество и детали."],"mapping":["D","I","S","C"]},{"n":19,"options":["Я быстрее принимаю решение и потом уточняю детали.","Я быстрее уточняю детали и потом принимаю решение.","Я предпочитаю согласовать с людьми и не ломать отношения.","Я предпочитаю вдохновить и увлечь — и решение придёт."],"mapping":["D","C","S","I"]},{"n":20,"options":["Мне проще работать с конфликтом прямо и жёстко.","Мне проще разрядить конфликт и снизить напряжение.","Мне проще избегать конфликта и сохранить мир.","Мне проще перевести конфликт в обсуждение фактов и критериев."],"mapping":["D","I","S","C"]},{"n":21,"options":["Если врач занят, я быстро обозначу цель и «сожму» разговор.","Если врач занят, я попробую зацепить интересом и вовлечь.","Если врач занят, я спокойно подстроюсь и перенесу/согласую.","Если врач занят, я уточню, что именно критично и какие данные нужны."],"mapping":["D","I","S","C"]},{"n":22,"options":["Я чаще работаю через KPI/результаты/план.","Я чаще работаю через отношения/сеть/влияние.","Я чаще работаю через сервисность и сопровождение.","Я чаще работаю через качество и корректность."],"mapping":["D","I","S","C"]},{"n":23,"options":["В подготовке к визиту я скорее ограничу время и сделаю достаточно.","В подготовке к визиту я скорее сделаю идеально и проверю всё.","В подготовке к визиту я скорее учту отношения и историю с врачом.","В подготовке к визиту я скорее подумаю, как подать интересно и вовлечь."],"mapping":["D","C","S","I"]},{"n":24,"options":["После визита думаю, как лучше сопровождать и не потерять связь.","После визита проверяю, всё ли корректно и что улучшить в процессе.","После визита фиксирую действия и сразу ставлю следующий шаг.","После визита отмечаю, что сработало в контакте и эмоциях."],"mapping":["S","C","D","I"]}];

  const TIPS = {"D":{"title":"D — Доминирование","bullets":["• В визите: быстро к сути, фокус на цели/следующем шаге, уверенно работаете с возражениями.","• Сильные стороны: решительность, темп, умение договариваться про конкретику.","• Риски: можете «давить» и недослушивать; важно оставлять место вопросам врача.","• Полезная привычка: задавать 2–3 уточняющих вопроса перед предложением решения."]},"I":{"title":"I — Влияние","bullets":["• В визите: контакт, лёгкость, умение вовлечь, хорошо заходят истории/кейсы.","• Сильные стороны: отношения, презентация, мотивация, расширение сети контактов.","• Риски: можно уйти в разговор и потерять структуру/факты; держите «якоря».","• Полезная привычка: завершать визит конкретным договорённым действием и сроком."]},"S":{"title":"S — Стабильность","bullets":["• В визите: спокойный темп, доверие, внимательное сопровождение, сильны в долгих циклах.","• Сильные стороны: надёжность, сервисность, удержание ЛПР, качественное сопровождение.","• Риски: сложнее продавливать решения и быстро менять план; тренируйте жёсткость в рамках уважения.","• Полезная привычка: заранее готовить 1–2 «жёстких» формулировки для запроса следующего шага."]},"C":{"title":"C — Точность","bullets":["• В визите: факты, исследования, корректность формулировок, выстраивание логики.","• Сильные стороны: доказательная база, качество материалов, аккуратность с регламентами.","• Риски: можно затянуть подготовку и быть слишком осторожным(ой); тренируйте «достаточно хорошо».","• Полезная привычка: лимитировать подготовку по времени и заранее выбрать ключевой месседж."]}};

  const STYLES = ["D","I","S","C"];
  const STYLE_FULL = {
    D: "D — Dominance / Доминирование",
    I: "I — Influence / Влияние",
    S: "S — Steadiness / Стабильность",
    C: "C — Conscientiousness / Точность"
  };

  const blocksRoot = document.getElementById('blocks');
  const answeredEl = document.getElementById('answered');
  const progFill = document.getElementById('progFill');
  const btnCalc = document.getElementById('btnCalc');
  const btnReset = document.getElementById('btnReset');
  const btnDownload = document.getElementById('btnDownload');
  const toastEl = document.getElementById('toast');

  let lastResult = null;

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.style.display = 'block';
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>toastEl.style.display='none', 2200);
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m)=>({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
    }[m]));
  }

  function renderInstructions(){
    document.getElementById('instructions').innerHTML = INSTRUCTIONS
      .filter(Boolean)
      .map(s=>`<div>${escapeHtml(s)}</div>`)
      .join('');
  }

  function build(){
    blocksRoot.innerHTML = '';
    BLOCKS.forEach((b, idx)=>{
      const wrap = document.createElement('div');
      wrap.className = 'block';
      wrap.dataset.block = String(idx);

      wrap.innerHTML = `
        <div class="blockTop">
          <div><div class="bTitle">Блок ${b.n}</div></div>
          <div class="controls">
            <label>
              <div style="font-size:11px;color:var(--muted);margin:0 0 4px;text-transform:uppercase;letter-spacing:.6px">MOST</div>
              <select class="sel most">
                <option value="">— выбери —</option>
                <option value="1">Вариант 1</option>
                <option value="2">Вариант 2</option>
                <option value="3">Вариант 3</option>
                <option value="4">Вариант 4</option>
              </select>
            </label>
            <label>
              <div style="font-size:11px;color:var(--muted);margin:0 0 4px;text-transform:uppercase;letter-spacing:.6px">LEAST</div>
              <select class="sel least">
                <option value="">— выбери —</option>
                <option value="1">Вариант 1</option>
                <option value="2">Вариант 2</option>
                <option value="3">Вариант 3</option>
                <option value="4">Вариант 4</option>
              </select>
            </label>
          </div>
        </div>

        <table>
          <thead><tr><th style="width:64px">№</th><th>Фраза</th></tr></thead>
          <tbody>
            ${b.options.map((t,i)=>`<tr><td style="font-family:var(--mono);font-weight:900">${i+1}</td><td class="opt">${escapeHtml(t)}</td></tr>`).join("")}
          </tbody>
        </table>

        <div class="err">В этом блоке MOST и LEAST должны быть разными вариантами.</div>
      `;

      blocksRoot.appendChild(wrap);

      const most = wrap.querySelector('select.most');
      const least = wrap.querySelector('select.least');

      most.addEventListener('change', ()=> onChange(idx));
      least.addEventListener('change', ()=> onChange(idx));
    });

    renderInstructions();
    updateProgress();
    renderEmptyResult();
  }

  function onChange(idx){
    const node = document.querySelector(`.block[data-block="${idx}"]`);
    const most = node.querySelector('select.most').value;
    const least = node.querySelector('select.least').value;

    const isBad = most && least && most === least;

    if (isBad){
      // Дуракаустойчиво: если выбрал одинаково — очищаем LEAST
      node.querySelector('select.least').value = '';
      toast('MOST и LEAST должны быть разными — LEAST очищен.');
    }

    lastResult = null;
    renderEmptyResult(true);
    updateProgress();
  }

  function updateProgress(){
    let ok = 0;
    for (let i=0;i<BLOCKS.length;i++){
      const node = document.querySelector(`.block[data-block="${i}"]`);
      const most = node.querySelector('select.most').value;
      const least = node.querySelector('select.least').value;
      if (most && least && most !== least) ok++;
    }
    answeredEl.textContent = ok;
    const pct = Math.round((ok / BLOCKS.length) * 100);
    progFill.style.width = pct + '%';

    // Кнопки
    btnCalc.disabled = ok !== BLOCKS.length;
    btnDownload.disabled = !(ok === BLOCKS.length && lastResult); // включится после расчёта
  }

  function score(){
    const mostCount = {D:0,I:0,S:0,C:0};
    const leastCount = {D:0,I:0,S:0,C:0};

    for (let i=0;i<BLOCKS.length;i++){
      const b = BLOCKS[i];
      const node = document.querySelector(`.block[data-block="${i}"]`);
      const most = node.querySelector('select.most').value;
      const least = node.querySelector('select.least').value;
      if (!most || !least || most === least) return null;

      const mStyle = b.mapping[Number(most)-1];
      const lStyle = b.mapping[Number(least)-1];
      mostCount[mStyle] += 1;
      leastCount[lStyle] += 1;
    }

    const net = {D:0,I:0,S:0,C:0};
    for (const k of STYLES) net[k] = mostCount[k] - leastCount[k];

    const order = STYLES.map(k => ({k, v:net[k]})).sort((a,b)=>b.v-a.v);
    const lead = order[0]?.k || '—';
    const second = order[1]?.k || '—';
    const diff = (order[0] && order[1]) ? (order[0].v - order[1].v) : null;

    return { mostCount, leastCount, net, order, lead, second, diff };
  }

  function renderEmptyResult(keepHints){
    if (!keepHints){
      document.getElementById('leadBadge').textContent = 'DISC';
      document.getElementById('leadText').textContent = '—';
      document.getElementById('mixNote').textContent = '';
      document.getElementById('visitTips').innerHTML = '<span style="color:var(--muted)">Заполни тест — и здесь появятся рекомендации.</span>';
    }
    renderScoreRows({D:0,I:0,S:0,C:0}, {D:0,I:0,S:0,C:0}, {D:0,I:0,S:0,C:0});
  }

  function renderScoreRows(mostCount, leastCount, net){
    const wrap = document.getElementById('scoreRows');
    wrap.innerHTML = '';

    // NET range: [-24..+24]
    const maxAbs = 24;
    const toPct = (v) => Math.round(((v + maxAbs) / (2*maxAbs)) * 100);

    const order = STYLES.map(k => ({k, v: net[k]})).sort((a,b)=>b.v-a.v);

    order.forEach(({k, v})=>{
      const row = document.createElement('div');
      row.className = 'scoreRow';
      row.innerHTML = `
        <div class="k">${k}</div>
        <div>
          <div class="meter"><div style="width:${toPct(v)}%"></div></div>
          <div style="display:flex; justify-content:space-between; gap:10px; margin-top:6px; font-size:12px; color:var(--muted)">
            <div>MOST: <b style="font-family:var(--mono)">${mostCount[k]}</b></div>
            <div>LEAST: <b style="font-family:var(--mono)">${leastCount[k]}</b></div>
          </div>
        </div>
        <div class="v">${v>=0?"+":""}${v}</div>
      `;
      wrap.appendChild(row);
    });
  }

  function renderTipsForLead(lead){
    const tipsBox = document.getElementById('visitTips');
    if (!lead || lead === '—' || !TIPS[lead]){
      tipsBox.innerHTML = '<span style="color:var(--muted)">Заполни тест — и здесь появятся рекомендации.</span>';
      return;
    }
    const t = TIPS[lead];
    tipsBox.innerHTML = `
      <div style="font-weight:900; margin-bottom:6px">${escapeHtml(t.title)}</div>
      <ul class="list">
        ${(t.bullets||[]).map(x=>`<li>${escapeHtml(x.replace(/^•\s?/,''))}</li>`).join("")}
      </ul>
    `;
  }

  function calcAndShow(){
    const r = score();
    if (!r){ toast('Заполни все блоки: MOST и LEAST должны быть выбраны и различаться.'); return; }

    lastResult = r;

    document.getElementById('leadBadge').textContent = r.lead;
    document.getElementById('leadText').textContent = `Основной стиль: ${STYLE_FULL[r.lead]}`;

    if (r.diff === null) document.getElementById('mixNote').textContent = '';
    else if (r.diff <= 2) document.getElementById('mixNote').textContent = `Смешанный профиль: ${r.lead}/${r.second} (разница NET = ${r.diff}).`;
    else document.getElementById('mixNote').textContent = `Вторичный стиль: ${STYLE_FULL[r.second]}. Разница NET = ${r.diff}.`;

    renderScoreRows(r.mostCount, r.leastCount, r.net);
    renderTipsForLead(r.lead);

    btnDownload.disabled = false;
    document.getElementById('resultCard').scrollIntoView({behavior:'smooth', block:'start'});
  }

  function resetAll(){
    document.querySelectorAll('select.sel').forEach(s => s.value = '');
    lastResult = null;
    renderEmptyResult();
    updateProgress();
    toast('Сброшено.');
    window.scrollTo({top:0, behavior:'smooth'});
  }

  function getNowStamp(){
    const d = new Date();
    const pad = (n)=> String(n).padStart(2,'0');
    return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}_${pad(d.getHours())}${pad(d.getMinutes())}`;
  }

  function downloadResultPDF(){
    // На всякий случай пересчитаем, если пользователь не нажал "Показать результат"
    let r = lastResult;
    if (!r) r = score();
    if (!r){ toast('Сначала заполни все блоки и нажми «Показать результат».'); return; }

    const tips = (r.lead && TIPS[r.lead]) ? TIPS[r.lead] : null;

    const esc = escapeHtml;
    const rows = STYLES.map(k=>`
      <tr>
        <td style="font-family: ui-monospace, Menlo, Consolas, monospace; font-weight:900;">${k}</td>
        <td>${r.mostCount[k]}</td>
        <td>${r.leastCount[k]}</td>
        <td style="font-family: ui-monospace, Menlo, Consolas, monospace; font-weight:900;">${r.net[k]>=0?"+":""}${r.net[k]}</td>
      </tr>
    `).join('');

    const bullets = tips ? (tips.bullets||[]).map(x=>`<li>${esc(x.replace(/^•\s?/,''))}</li>`).join('') : '';

    const diffText = (r.diff===null) ? '' : (r.diff<=2 ? `Смешанный профиль: ${r.lead}/${r.second} (разница NET = ${r.diff}).`
                                                   : `Вторичный стиль: ${STYLE_FULL[r.second]}. Разница NET = ${r.diff}.`);

    const html = `
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>DISC_result_${getNowStamp()}</title>
  <style>
    @page { size: A4; margin: 16mm; }
    body{ font-family: Arial, system-ui, sans-serif; color:#0b1220; }
    .head{display:flex; gap:12px; align-items:center; margin-bottom:10px;}
    .logo{width:38px; height:38px; border-radius:12px; background: linear-gradient(135deg, #0057B8, #00A3E0);}
    h1{margin:0; font-size:18px;}
    .sub{color:#5b667a; font-size:12px; margin:2px 0 12px;}
    .box{border:1px solid #e3e8f2; border-radius:14px; padding:12px; margin:10px 0;}
    table{width:100%; border-collapse:collapse; margin-top:8px;}
    th, td{border-bottom:1px solid #e3e8f2; padding:8px; font-size:12px; text-align:left;}
    th{color:#5b667a; text-transform:uppercase; letter-spacing:.6px;}
    .badge{display:inline-block; padding:4px 10px; border-radius:999px; background:#f1f5ff; border:1px solid #dbe6ff; font-weight:900; font-family: ui-monospace, Menlo, Consolas, monospace;}
    ul{margin:6px 0 0; padding-left:18px;}
    li{margin:6px 0; font-size:12px;}
    .muted{color:#5b667a; font-size:12px;}
  </style>
</head>
<body>
  <div class="head">
    <div class="logo"></div>
    <div>
      <h1>DISC — результат самооценки</h1>
      <div class="sub">Медицинские представители • NET = MOST − LEAST • сформировано локально</div>
    </div>
  </div>

  <div class="box">
    <div class="muted">Основной стиль</div>
    <div style="font-size:16px; font-weight:900; margin:4px 0;">
      <span class="badge">${r.lead}</span> &nbsp; ${esc(STYLE_FULL[r.lead])}
    </div>
    <div class="muted">${esc(diffText)}</div>
  </div>

  <div class="box">
    <div style="font-weight:900; font-size:13px; margin-bottom:6px;">Счёт по шкалам</div>
    <table>
      <thead><tr><th style="width:50px;">Шкала</th><th>MOST</th><th>LEAST</th><th>NET</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>
  </div>

  <div class="box">
    <div style="font-weight:900; font-size:13px; margin-bottom:6px;">Рекомендации для визита (по ведущему стилю)</div>
    ${
      tips
      ? `<div style="font-weight:900; margin-bottom:6px;">${esc(tips.title)}</div><ul>${bullets}</ul>`
      : `<div class="muted">Нет данных для рекомендаций.</div>`
    }
  </div>

  <div class="muted">
    Примечание: это базовая самооценка для развития коммуникации. Не является клинической диагностикой и не предназначена для решений о найме.
  </div>
</body>
</html>
    `;

    const w = window.open('', '_blank');
    if (!w){ toast('Браузер заблокировал всплывающее окно. Разреши pop-up для этого сайта.'); return; }
    w.document.open();
    w.document.write(html);
    w.document.close();
    w.focus();

    // Печать -> "Save as PDF"
    setTimeout(()=>{ w.print(); }, 250);
  }

  btnCalc.addEventListener('click', calcAndShow);
  btnReset.addEventListener('click', resetAll);
  btnDownload.addEventListener('click', downloadResultPDF);

  build();
</script>
</body>
</html>
